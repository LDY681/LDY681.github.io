<!DOCTYPE html>
<html lang="zh">
<head>
  <title>转世三国-模拟三国人生</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../css/w3.css">
  <link rel="stylesheet" href="../css/all.css">
  <link rel="stylesheet" href="../css/my-style.css">
  <link rel="icon" href="../img/logo.png"/>
  <link href="../css/leaflet.css" rel="stylesheet" />

  <!--加载leaflet地图js-->
  <script src="../js/leaflet.js"></script>
  <script src="../js/leaflet.ChineseTmsProviders.js"></script>
</head>

<body class="w3-animate-opacity">
<!--  载入的navSideBar-->
<div style="position: relative" id="nav-placeholder"></div>

<!--正文内容-->
<div id="customContent" style="margin-left:0;" class="w3-row">

<!-- mapMenu-->
  <ul class="w3-col w3-light-gray w3-card-4" style="width:250px;margin-top:80px;list-style-type:none;border-radius: 50px 0 0 50px;" id="mapMenu">
    <li class="w3-xxlarge">魏国</li>
    <li class="w3-xlarge">河北</li>
    <li class="w3-large">幽州</li>
    <li onclick="getMap(1);"><a href="#">襄平  幽州─辽东郡</a></li>
    <li onclick="getMap(2);"><a href="#">北平  幽州—右北平郡</a></li>
    <li onclick="getMap(3);"><a href="#">蓟  幽州─燕国蓟县</a></li>
    <li class="w3-large">冀州</li>
    <li onclick="getMap(4);"><a href="#">南皮  冀州─渤海郡</a></li>
    <li onclick="getMap(5);"><a href="#">中山  冀州─中山郡</a></li>
    <li onclick="getMap(6);"><a href="#">钜鹿  冀州─巨鹿郡</a></li>
    <li onclick="getMap(7);"><a href="#">甘陵  冀州─清河郡</a></li>
    <li onclick="getMap(8);"><a href="#">邺  冀州─魏郡</a></li>
    <li class="w3-large">并州</li>
    <li onclick="getMap(9);"><a href="#">晋阳  并州─太原郡</a></li>
    <li onclick="getMap(10);"><a href="#">上党  并州─上党郡</a></li>
    <li class="w3-large">青州</li>
    <li onclick="getMap(11);"><a href="#">平原  青州─平原郡</a></li>
    <li onclick="getMap(12);"><a href="#">北海  青州─北海国</a></li>

    <li class="w3-xlarge">中原</li>
    <li class="w3-large">徐州</li>
    <li onclick="getMap(13);"><a href="#">琅琊  徐州─琅琊国</a></li>
    <li onclick="getMap(14);"><a href="#">下邳  徐州─州治</a></li>
    <li onclick="getMap(15);"><a href="#">广陵  徐州─广陵郡</a></li>
    <li class="w3-large">兖州</li>
    <li onclick="getMap(16);"><a href="#">济北 兖州─济阳郡</a></li>
    <li onclick="getMap(17);"><a href="#">濮阳  兖州─东郡</a></li>
    <li onclick="getMap(18);"><a href="#">陈留  兖州─陈留国</a></li>
    <li class="w3-large">豫州</li>
    <li onclick="getMap(19);"><a href="#">小沛  豫州─沛国</a></li>
    <li onclick="getMap(20);"><a href="#">谯  豫州─谯郡</a></li>
    <li onclick="getMap(21);"><a href="#">许昌  豫州─颖川郡</a></li>
    <li onclick="getMap(22);"><a href="#">汝南  豫州─汝南郡</a></li>
    <li onclick="getMap(23);"><a href="#">宛  豫州─南阳郡</a></li>
    <li class="w3-large">司隶</li>
    <li onclick="getMap(24);"><a href="#">河内  司隶─河内郡</a></li>
    <li onclick="getMap(25);"><a href="#">洛阳  司隶─河南尹</a></li>
    <li onclick="getMap(26);"><a href="#">弘农  司隶─弘农郡</a></li>


    <li class="w3-xxlarge">蜀国</li>
    <li class="w3-xlarge">西北</li>
    <li class="w3-large">雍州</li>
    <li onclick="getMap(27);"><a href="#">长安  雍州─京兆尹</a></li>
    <li onclick="getMap(28);"><a href="#">安定  雍州─安定郡</a></li>
    <li onclick="getMap(29);"><a href="#">天水  雍州─天水郡</a></li>
    <li class="w3-large">凉州</li>
    <li onclick="getMap(30);"><a href="#">武威  凉州─武威郡</a></li>
    <li onclick="getMap(31);"><a href="#">金城  凉州─金城郡</a></li>

    <li class="w3-xlarge">巴蜀</li>
    <li class="w3-large">益州</li>
    <li onclick="getMap(32);"><a href="#">武都  益州─武都郡</a></li>
    <li onclick="getMap(33);"><a href="#">汉中  益州─汉中郡</a></li>
    <li onclick="getMap(34);"><a href="#">永安  益州─巴东郡</a></li>
    <li onclick="getMap(35);"><a href="#">梓潼  益州─梓潼郡</a></li>
    <li onclick="getMap(36);"><a href="#">成都  益州─蜀郡</a></li>
    <li onclick="getMap(37);"><a href="#">江州  益州─巴郡</a></li>
    <li onclick="getMap(38);"><a href="#">牂牁  益州─牂牁郡</a></li>
    <li onclick="getMap(39);"><a href="#">越巂  益州─越巂郡</a></li>
    <li onclick="getMap(40);"><a href="#">建宁  益州─建宁郡</a></li>
    <li onclick="getMap(41);"><a href="#">永昌  益州─永昌郡</a></li>
    <li onclick="getMap(42);"><a href="#">上庸  益州─上庸郡</a></li>


    <li class="w3-xxlarge">吴国</li>
    <li class="w3-xlarge">荆楚</li>
    <li class="w3-large">荆州</li>
    <li onclick="getMap(43);"><a href="#">新野  荆州─南阳郡</a></li>
    <li onclick="getMap(44);"><a href="#">襄阳  荆州─襄阳郡</a></li>
    <li onclick="getMap(45);"><a href="#">江夏  荆州─江夏郡</a></li>
    <li onclick="getMap(46);"><a href="#">江陵  荆州─南郡</a></li>
    <li onclick="getMap(47);"><a href="#">长沙  荆州─长沙郡</a></li>
    <li onclick="getMap(48);"><a href="#">武陵  荆州─武陵郡</a></li>
    <li onclick="getMap(49);"><a href="#">桂阳  荆州─桂阳郡</a></li>
    <li onclick="getMap(50);"><a href="#">零陵  荆州─零陵郡</a></li>

    <li class="w3-xlarge">吴越</li>
    <li class="w3-large">扬州</li>
    <li onclick="getMap(51);"><a href="#">寿春  扬州─州治</a></li>
    <li onclick="getMap(52);"><a href="#">庐江  扬州─庐江郡</a></li>
    <li onclick="getMap(53);"><a href="#">建业  扬州─丹阳郡</a></li>
    <li onclick="getMap(54);"><a href="#">吴  扬州─吴郡</a></li>
    <li onclick="getMap(55);"><a href="#">会稽  扬州─会稽郡</a></li>
    <li onclick="getMap(56);"><a href="#">豫章  扬州─豫章郡</a></li>
    <li onclick="getMap(57);"><a href="#">建安  扬州─建安郡</a></li>
    <li class="w3-large">交州</li>
    <li onclick="getMap(58);"><a href="#">南海  交州─南海郡</a></li>
    <li onclick="getMap(59);"><a href="#">合浦  交州─合浦郡</a></li>
    <li onclick="getMap(60);"><a href="#">交趾  交州─龙编</a></li>

  </ul>

  <!--地图contianer-->
  <div id="mapContainer" class="w3-rest w3-card-4" style="margin-top:80px">
    <div id="mapLayer"></div>
  </div>
</div>

<!--Script加载顺序!!!!!-->
<!--加载jquery-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script>console.log("Jquery加载完毕")</script>
<script src="../js/handlebars.min.js"></script>
<script>console.log("handlebars加载完毕")</script>

<!--初始化用户并加载user.js-->
<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.14.0/dist/av-min.js"></script>
<script src="../js/initLeanCloud.js"></script>
<script src="../js/user.js"></script> <!--登录注册,登出,isCurrentUser-->
<script>console.log("User初始化完毕;")</script>

<!--加载counter.js-->
<script src="../js/counter.js"></script> <!--活动倒计时,东汉年历,当前时间-->

<!--使用jquery 加载navSideBar和userMenu到相关的placeholder中-->
<!--这个script执行完只是call了jquery.load,可能jquery.load要load的内容还没有加载完,此时后面加载的js,如果依赖于load的内容则可能会报错-->
<!--解决办法  $("#nav-placeholder").load("navSideBar.html", function(){ $.getScript("../js/navSideBar.js");}-->
<script>
    $("#nav-placeholder").load("navSideBar.html", function(){
        console.log("navSideBar加载完毕");

        $.getScript("../js/navSideBar.js", function(){
            console.log("navSideBar.js读取完毕,开始执行&displayRightOnLarge");
            displayRightOnLarge();
            $.getScript("../js/translate.js", function(){
                console.log("translate.js读取完毕,开始执行detectLang");
                detectLang();
            });
        });
    });
</script>

<script>
    /*** 高德地图*/
    var Gaode = L.tileLayer.chinaProvider('GaoDe.Normal.Map', {maxZoom: 18,minZoom: 5});
    var Gaodimgem = L.tileLayer.chinaProvider('GaoDe.Satellite.Map', {maxZoom: 18,minZoom: 5});
    var Gaodimga = L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion', {maxZoom: 18,minZoom: 5});
    var Gaodimage = L.layerGroup([Gaodimgem, Gaodimga]);

    var map = L.map("mapLayer", {
        center: [35.74874, 116.05408],
        zoom: 5,
        layers: [Gaode],
        zoomControl: false
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="https://zssanguo.com">转世三国</a>'}).addTo(map);

    // 和平状态蜀国城池图标
    var shuCityIcon = L.icon({
        iconUrl: 'https://zssanguo.com/img/shuCityIcon.png',
        iconSize:     [48,48],    // size of the icon
        // iconAnchor:   [30,30], // point of the icon which will correspond to marker's location
        popupAnchor:  [-5, -40] // point from which the popup should open relative to the iconAnchor
    });

    // 和平状态魏国城池图标
    var weiCityIcon = L.icon({
        iconUrl: 'https://zssanguo.com/img/weiCityIcon.png',
        iconSize:     [48,48],    // size of the icon
        // iconAnchor:   [30,30], // point of the icon which will correspond to marker's location
        popupAnchor:  [-5, -40] // point from which the popup should open relative to the iconAnchor
    });

    // 和平状态吴国城池图标
    var wuCityIcon = L.icon({
        iconUrl: 'https://zssanguo.com/img/wuCityIcon.png',
        iconSize:     [48,48],    // size of the icon
        popupAnchor:  [-5, -40] // point from which the popup should open relative to the iconAnchor
    });

    // 和平状态黄巾城池图标
    var huangCityIcon = L.icon({
        iconUrl: 'https://zssanguo.com/img/huangCityIcon.png',
        iconSize:     [48,48],    // size of the icon
        popupAnchor:  [-5, -40] // point from which the popup should open relative to the iconAnchor
    });

    var warCityIcon = L.icon({
        iconUrl: 'https://zssanguo.com/img/warCityIcon.png',
        iconSize:     [48,48],    // size of the icon
        popupAnchor:  [-5, -40] // point from which the popup should open relative to the iconAnchor
    });

    // 编号,城市名称,坐标,图片地址,描述内容,点击链接
    var list = [
        // 魏国城池 26座
        [1,'襄平',[41.26955, 123.17596],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [2,'北平',[41.24271, 119.41589],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [3,'蓟',[40.04864, 117.39716],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [4,'南皮',[38.05674, 116.70502],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [5,'中山',[38.51594, 115.00488],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [6,'钜鹿',[37.63381, 114.93073],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [7,'甘陵',[36.84666, 115.71075],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [8,'邺',[36.59348, 114.49402],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [9,'晋阳',[37.90737, 112.56317],'','<p>	</p><span>所属国家：</span>','https://zssanguo.com'],
        [10,'上党',[36.22544, 113.1015],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [11,'平原',[37.18439, 116.44135],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [12,'北海',[36.72788, 119.20029],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [13,'琅琊',[35.06148, 118.32275],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [14,'下邳',[33.94336, 118.02612],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [15,'广陵',[33.53224, 119.03687],'','<p></p><span>	所属国家：</span>','https://zssanguo.com'],
        [16,'济北',[35.18279, 115.46631],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [17,'濮阳',[35.69299, 115.02686],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [18,'陈留',[34.67388, 114.53522],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [19,'小沛',[34.7371, 116.95633],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [20,'谯',[33.85217, 115.77942],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [21,'许昌',[34.03104, 113.82797],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [22,'汝南',[33.27658, 114.26605],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [23,'宛',[32.98102, 112.54395],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [24,'河内',[35.10418, 113.41873],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [25,'洛阳',[34.6366, 112.46292],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [26,'弘农',[34.52466, 110.89874],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],

        // 蜀国城池  16座
        [27,'长安',[34.34996, 108.94009],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [28,'安定',[35.33641, 107.36389],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [29,'天水',[34.8634, 105.66101],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [30,'武威',[37.93662, 102.62466],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [31,'金城',[36.0491, 103.83179],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [32,'武都',[33.74261, 105.76263],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [33,'汉中',[33.07773, 107.02881],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [34,'永安',[31.0191, 109.47464],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [35,'梓潼',[31.64403, 105.18311],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [36,'成都',[30.57645, 104.07349],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [37,'江州',[29.54957, 106.55365],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [38,'牂牁',[26.26633, 107.52869],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [39,'越巂',[27.87975, 102.26761],'','<p></p><span>所属国家： </span>','https://zssanguo.com'],
        [40,'建宁',[25.48543, 103.79883],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [41,'永昌',[25.10923, 99.16122],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [42,'上庸',[32.23836, 110.2533],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        //吴国城池 18座

        [43,'新野',[32.53176, 112.36679],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [44,'襄阳',[32.05464, 112.13882],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [45,'江夏',[31.02411, 113.75381],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [46,'江陵',[30.36103, 112.18964],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [47,'长沙',[29.4683, 113.45581],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [48,'武陵',[29.02976, 111.6925],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [49,'桂阳',[25.743, 112.73895],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [50,'零陵',[26.22445, 111.63208],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [51,'寿春',[32.58038, 116.79291],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [52,'庐江',[30.73593, 116.83685],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [53,'建业',[31.99876, 118.79517],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [54,'吴',[31.29967, 120.62164],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [55,'会稽',[29.99895, 120.58182],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [56,'豫章',[28.70022, 115.85083],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [57,'建安',[27.02457, 118.30593],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [58,'南海',[22.93848, 113.38852],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [59,'合浦',[21.68295, 109.23157],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
        [60,'交趾',[21.01273, 105.82855],'','<p></p><span>所属国家：</span>','https://zssanguo.com'],
    ];

    // 地图上显示城池
    const battlehtml = "../html/city.html?id=";
    // 因为mapID是从1开始的,list index是从0开始的,所以记得要减一
    var query = new AV.Query('city');
    query.include(['owner']);
    query.find().then(function (cities) {
        cities.forEach(function(city) {
            if ( city.get("isAtWar") === false){
                if (city.get('owner').get('name') === "weiguo"){
                    $j = city.get('cityId');                                                                                                                       //编号+城市名+所属州郡+现在地址+战场链接
                    L.marker([list[$j-1][2][0],list[$j-1][2][1]],{icon: weiCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j-1][0] + ". " + list[$j-1][1] + "</font></h3>"+ list[$j-1][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j] + "' target=_blank>" +"进入城市"+"</a></div>");
                }else if (city.get('owner').get('name') === "shuguo"){
                    $j = city.get('cityId');
                    L.marker([list[$j-1][2][0],list[$j-1][2][1]],{icon: shuCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j-1][0] + ". " + list[$j-1][1] + "</font></h3>"+ list[$j-1][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j] + "' target=_blank>" +"进入城市"+"</a></div>");
                }else if (city.get('owner').get('name') === "wuguo"){
                    $j = city.get('cityId');
                    L.marker([list[$j-1][2][0],list[$j-1][2][1]],{icon: wuCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j-1][0] + ". " + list[$j-1][1] + "</font></h3>"+ list[$j-1][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j] + "' target=_blank>" +"进入城市"+"</a></div>");
                }else{
                    $j = city.get('cityId');
                    L.marker([list[$j-1][2][0],list[$j-1][2][1]],{icon: huangCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j-1][0] + ". " + list[$j-1][1] + "</font></h3>"+ list[$j-1][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j] + "' target=_blank>" +"进入城市"+"</a></div>");
                }
            }else{
                $j = city.get('cityId');
                L.marker([list[$j-1][2][0],list[$j-1][2][1]],{icon: warCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j-1][0] + ". " + list[$j-1][1] + "</font></h3>"+ list[$j-1][4]  + "交战中!" + "<br><br>" + "<a  href='"+ battlehtml + [$j] + "' target=_blank>" +"进入城市"+"</a></div>");
            }

        });
    });

    //点击mapMenu显示popUp
    function getMap(cityID) {
        console.log("cityId是: "+ cityID);
        var query = new AV.Query('city');
        query.include(['owner']);
        query.equalTo('cityId', cityID);
        query.find().then(function(cities){
            var city = cities[0];
            console.log(city.get("name"));
            $j=cityID-1;

            if ( city.get("isAtWar") === false){
                if (city.get('owner').get('name') === "weiguo"){
                    L.marker([list[$j][2][0],list[$j][2][1]],{icon: weiCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j][0] + ". " + list[$j][1] + "</font></h3>"+ list[$j][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j+1] + "' target=_blank>" +"进入城市"+"</a></div>").openPopup();
                }else if (city.get('owner').get('name') === "shuguo"){
                    L.marker([list[$j][2][0],list[$j][2][1]],{icon: shuCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j][0] + ". " + list[$j][1] + "</font></h3>"+ list[$j][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j+1] + "' target=_blank>" +"进入城市"+"</a></div>").openPopup();
                }else if (city.get('owner').get('name') === "wuguo"){
                    L.marker([list[$j][2][0],list[$j][2][1]],{icon: wuCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j][0] + ". " + list[$j][1] + "</font></h3>"+ list[$j][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j+1] + "' target=_blank>" +"进入城市"+"</a></div>").openPopup();
                }else{
                    L.marker([list[$j][2][0],list[$j][2][1]],{icon: huangCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j][0] + ". " + list[$j][1] + "</font></h3>"+ list[$j][4]  + city.get('owner').get('cname') + "<br><br>" + "<a  href='"+ battlehtml + [$j+1] + "' target=_blank>" +"进入城市"+"</a></div>").openPopup();
                }
            }else{
                L.marker([list[$j][2][0],list[$j][2][1]],{icon: warCityIcon}).addTo(map).bindPopup("<div class='popupInfo'><h3><font color='#00a6ac'>" +list[$j][0] + ". " + list[$j][1] + "</font></h3>"+ list[$j][4]  + "交战中!" + "<br><br>" + "<a  href='"+ battlehtml + [$j+1] + "' target=_blank>" +"进入城市"+"</a></div>").openPopup();
            }
        });
    }

    //弹窗
    var popup = new L.popup();
    function onMapClick(e) {
        popup.setLatLng(e.latlng).setContent(e.latlng.toString()).openOn(map);
    }
    map.on('click', onMapClick);

    var xiangping = 0;
    var beiping = 1;
    var ji = 2;
    var nanpi = 3;
    var zhongshan = 4;
    var julu = 5;
    var ganling = 6;
    var ye = 7;
    var jinyang = 8;
    var shangdang = 9;
    var pingyuan = 10;
    var beihai = 11;
    var langya = 12;
    var xiapi = 13;
    var guangling = 14;
    var jibei = 15;
    var puyang = 16;
    var chenliu = 17;
    var xiaopei = 18;
    var qiao = 19;
    var xuchang = 20;
    var runan = 21;
    var wan = 22;
    var henei = 23;
    var luoyang = 24;
    var hongnong = 25;
    var changan = 26;
    var anding = 27;
    var tianshui = 28;
    var wuwei = 29;
    var jincheng = 30;
    var wudu = 31;
    var hanzhong = 32;
    var yongan = 33;
    var zitong = 34;
    var chengdu = 35;
    var jiangzhou = 36;
    var zangke = 37;
    var yuexi = 38;
    var jianning = 39;
    var yongchang = 40;
    var shangyong = 41;
    var xinye = 42;
    var xiangyang = 43;
    var jiangxia = 44;
    var jiangling = 45;
    var changsha = 46;
    var wuling = 47;
    var guiyang = 48;
    var lingling = 49;
    var shouchun = 50;
    var lujiang = 51;
    var jianye = 52;
    var wu = 53;
    var kuaiji = 54;
    var yuzhang = 55;
    var jianan = 56;
    var nanhai = 57;
    var hepu = 58;
    var jiaozhi = 59;

    //添加相邻城市路径
    // 0 襄平 - 北平
    addPath(xiangping,beiping);
    // 1 北平 - 襄平
    addPath(beiping,xiangping);
    // 2 北平 - 蓟
    addPath(beiping,ji);
    // 3 北平 - 南皮
    addPath(beiping,nanpi);
    // 4 蓟 - 中山
    addPath(ji,zhongshan);
    // 5 蓟 - 南皮
    addPath(ji,nanpi);
    // 6 蓟 - 北平
    addPath(ji,beiping);
    // 7 南皮 - 甘陵
    addPath(nanpi,ganling);
    // 8 南皮 - 平原
    addPath(nanpi,pingyuan);
    // 9 南皮 - 蓟
    addPath(nanpi,ji);
    // 10 南皮 - 北平
    addPath(nanpi,beiping);
    //11 中山-钜鹿
    addPath(julu,zhongshan);
    //12 中山-蓟
    addPath(ji,zhongshan);
    //13 钜鹿-晋阳
    addPath(julu,jinyang);
    //14 钜鹿-甘陵
    addPath(julu,ganling);
    //15 钜鹿-中山
    addPath(julu,zhongshan);
    //16 钜鹿-南皮
    addPath(julu,nanpi);
    //17 甘陵-邺
    addPath(ganling, ye);
    //18 甘陵-平原
    addPath(ganling, pingyuan);
    //19 甘陵-钜鹿
    addPath(ganling, julu);
    //20 甘陵-济北
    addPath(ganling, jibei);
    //21 甘陵-南皮
    addPath(ganling, nanpi);

    //22 邺-上党
    addPath(ye, shangdang);
    //23 邺-甘陵
    addPath(ye, ganling);
    //24 邺-濮阳
    addPath(ye, puyang);
    //25 晋阳-上党
    addPath(jinyang, shangdang);
    // 26 晋阳-巨鹿
    addPath(jinyang, julu);
    //27上党-邺
    addPath(shangdang, ye);
    //28 上党-河内
    addPath(shangdang, henei);
    // 29 上党-弘农
    addPath(shangdang, hongnong);
    // 30 上党-晋阳
    addPath(shangdang, jinyang);
    //31平原-甘陵
    addPath(pingyuan, ganling);
    // 32南皮
    addPath(pingyuan, nanpi);
    // 33北海
    addPath(pingyuan, beihai);
    // 34济北
    addPath(pingyuan, jibei);

    //35北海-平原
    addPath(beihai, pingyuan);
    // 36济北
    addPath(beihai, jibei);
    // 37琅琊
    addPath(beihai, langya);

    //38琅琊-北海
    addPath(langya, beihai);
    // 39济北
    addPath(langya, jibei);
    // 40广陵
    addPath(langya, guangling);
    // 41下邳
    addPath(langya, xiapi);

    //42下邳-小沛
    addPath(xiapi, xiaopei);
    // 43寿春
    addPath(xiapi, shouchun);
    // 44琅琊
    addPath(xiapi, langya);

    //45广陵-寿春
    addPath(guangling, shouchun);
    // 46建业
    addPath(guangling, jianye);
    // 47琅琊
    addPath(guangling, langya);
    // 48吴
    addPath(guangling, wu);

    //49济北-甘陵
    addPath(jibei, ganling);
    // 50平原
    addPath(jibei, pingyuan);
    // 51濮阳
    addPath(jibei, puyang);
    // 52北海
    addPath(jibei, beihai);
    // 53小沛
    addPath(jibei, xiaopei);
    // 54琅琊
    addPath(jibei, langya);

    //55濮阳-济北
    addPath(puyang, jibei);
    // 56邺,
    addPath(puyang, ye);
    // 57陈留
    addPath(puyang, chenliu);

    //58陈留-河内
    addPath(chenliu, henei);
    // 59濮阳
    addPath(chenliu, puyang);
    // 60小沛
    addPath(chenliu, xiaopei);
    // 61谯
    addPath(chenliu, qiao);
    // 62许昌
    addPath(chenliu, xuchang);
    // 63洛阳
    addPath(chenliu, luoyang);

    //64小沛-陈留
    addPath(xiaopei, chenliu);
    // 65谯
    addPath(xiaopei, qiao);
    // 66下邳
    addPath(xiaopei, xiapi);
    //67济北
    addPath(xiaopei, jibei);

    //68谯-陈留
    addPath(qiao, chenliu);
    // 69小沛
    addPath(qiao, xiaopei);
    // 70寿春
    addPath(qiao, shouchun);
    // 71汝南
    addPath(qiao, runan);

    //72许昌-陈留
    addPath(xuchang, chenliu);
    // 73洛阳
    addPath(xuchang, luoyang);
    // 74宛
    addPath(xuchang, wan);
    // 75汝南
    addPath(xuchang, runan);

    //76汝南-许昌
    addPath(runan, xuchang);
    // 77谯
    addPath(runan, qiao);
    // 78寿春
    addPath(runan, shouchun);
    // 79新野
    addPath(runan, xinye);

    //80宛-弘农
    addPath(wan, hongnong);
    // 81许昌
    addPath(wan, xuchang);
    // 82新野
    addPath(wan, xinye);

    //83河内-陈留
    addPath(henei, chenliu);
    // 84上党
    addPath(henei, shangdang);
    // 85洛阳
    addPath(henei, luoyang);

    //86洛阳-许昌
    addPath(luoyang, xuchang);
    // 87弘农
    addPath(luoyang, hongnong);
    // 88河内
    addPath(luoyang, henei);
    // 89陈留
    addPath(luoyang, chenliu);

    //90弘农-上党
    addPath(hongnong, shangdang);
    // 91洛阳
    addPath(hongnong, luoyang);
    // 92宛
    addPath(hongnong, wan);
    // 93长安
    addPath(hongnong, changan);

    //94长安-安定
    addPath(changan, anding);
    // 95弘农
    addPath(changan, hongnong);
    // 96天水
    addPath(changan, tianshui);
    // 97武都
    addPath(changan, wudu);

    //98安定-虎威
    addPath(anding, wuwei);
    // 99长安
    addPath(anding, changan);
    // 100金城
    addPath(anding, jincheng);

    //101天水-金城
    addPath(jincheng, tianshui);
    // 102武都
    addPath(wudu, tianshui);
    // 103长安
    addPath(changan, tianshui);


    //104武威-金城
    addPath(jincheng, wuwei);
    // 105安定
    addPath(anding, wuwei);


    //106金城-天水
    addPath(jincheng, tianshui);
    // 107安定
    addPath(jincheng, anding);
    // 205安定
    addPath(jincheng, wuwei);


    //108武都-天水
    addPath(wudu, tianshui);
    // 109长安
    addPath(wudu, changan);
    // 110汉中
    addPath(wudu, hanzhong);
    // 111梓潼
    addPath(wudu, zitong);

    //112汉中-武都
    addPath(hanzhong, wudu);
    // 113梓潼
    addPath(hanzhong, zitong);
    // 114上庸
    addPath(hanzhong, shangyong);

    //115永安-江州
    addPath(yongan, jiangzhou);
    // 116江陵
    addPath(yongan, jiangling);

    //117梓潼-武都
    addPath(zitong, wudu);
    // 118汉中
    addPath(zitong, hanzhong);
    // 119成都
    addPath(zitong, chengdu);
    // 120江州
    addPath(zitong, jiangzhou);




    //121成都-梓潼
    addPath(chengdu,"江州",zitong,"成都");
    // 122江州
    addPath(jiangzhou,"江州",chengdu,"成都");
    // 123越巂
    addPath( yuexi,"越巂",chengdu,"成都");



    //124江州-梓潼
    addPath( zitong,"梓潼",jiangzhou,"江州");
    // 125成都
    addPath(chengdu,"成都",jiangzhou,"江州");
    // 126永安
    addPath(yongan,"永安",jiangzhou,"江州");
    // 127牂牁
    addPath( zangke,"牂牁",jiangzhou,"江州");
    // 128越巂
    addPath( yuexi,"越巂",jiangzhou,"江州");




    //129牂牁-江州
    addPath( jiangzhou,"江州",zangke,"牂牁");
    // 130建宁
    addPath( jianning,"建宁",zangke,"牂牁");
    // 131合浦
    addPath( hepu,"合浦",zangke,"牂牁");

    //132越巂-成都
    addPath( chengdu,"成都",yuexi,"越巂");
    // 133江州
    addPath( jiangzhou,"江州",yuexi,"越巂");
    // 134永昌
    addPath( yongchang,"永昌",yuexi,"越巂");

    //135建宁-永昌
    addPath( yongchang,"永昌",jianning,"建宁");
    // 136牂牁
    addPath( zangke,"牂牁",jianning,"建宁");
    // 137交趾
    addPath( jiaozhi,"交趾",jianning,"建宁");

    //138永昌-建宁
    addPath( jianning,"建宁",yongchang,"永昌");
    // 139越巂
    addPath( yuexi,"越巂",yongchang,"永昌");

    //140上庸-汉中
    addPath( hanzhong,"汉中",shangyong,"上庸");
    // 141新野
    addPath( xinye,"新野",shangyong,"上庸");
    // 142襄阳
    addPath( xiangyang,"襄阳",shangyong,"上庸");

    //143新野-上庸
    addPath( shangyong,"上庸",xinye,"新野");
    // 144宛
    addPath( wan,"宛",xinye,"新野");
    // 145汝南
    addPath( runan,"汝南",xinye,"新野");
    // 146襄阳
    addPath( xiangyang,"襄阳",xinye,"新野");
    // 147江夏
    addPath( jiangxia,"江夏",xinye,"新野");

    //148襄阳-新野
    addPath( xinye,"新野",xiangyang,"襄阳");
    // 149江陵
    addPath( jiangling,"江陵",xiangyang,"襄阳");
    // 150上庸
    addPath( shangyong,"上庸",xiangyang,"襄阳");


    //151江夏-新野
    addPath( xinye,"新野",jiangxia,"江夏");
    // 152豫章
    addPath( yuzhang,"豫章",jiangxia,"江夏");
    // 153庐江
    addPath( lujiang,"庐江",jiangxia,"江夏");

    //154江陵-襄阳
    addPath( xiangyang,"襄阳",jiangling,"江陵");
    //155永安
    addPath( yongan,"永安",jiangling,"江陵");
    // 156武陵
    addPath( wuling,"武陵",jiangling,"江陵");
    // 157长沙
    addPath( changsha,"长沙",jiangling,"江陵");

    //158长沙-江陵
    addPath( jiangling,"江陵",changsha,"长沙");
    // 159武陵
    addPath( wuling,"武陵",changsha,"长沙");
    // 160桂阳
    addPath( guiyang,"桂阳",changsha,"长沙");

    //161武陵-江陵
    addPath( jiangling,"江陵",wuling,"武陵");
    // 162长沙
    addPath( changsha,"长沙",wuling,"武陵");
    // 163零陵
    addPath( lingling,"零陵",wuling,"武陵");


    //164桂阳-长沙
    addPath( changsha,"长沙",guiyang,"桂阳");
    // 165零陵
    addPath( lingling,"零陵",guiyang,"桂阳");
    // 166南海
    addPath( nanhai,"南海",guiyang,"桂阳");

    //167零陵-武陵
    addPath( wuling,"武陵",lingling,"零陵");
    // 168桂阳
    addPath( guiyang,"桂阳",lingling,"零陵");
    // 169合浦
    addPath( hepu,"合浦",lingling,"零陵");

    //170寿春-谯
    addPath( qiao,"谯",shouchun,"寿春");
    // 171下邳
    addPath( xiapi,"下邳",shouchun,"寿春");
    // 172广陵
    addPath( guangling,"广陵",shouchun,"寿春");
    // 173庐江
    addPath( lujiang,"庐江",shouchun,"寿春");
    // 174建业
    addPath( jianye,"建业",shouchun,"寿春");
    // 175汝南
    addPath( runan,"汝南",shouchun,"寿春");

    //175庐江=江夏
    addPath( jiangxia,"江夏",lujiang,"庐江");
    // 176建业
    addPath( jianye,"建业",lujiang,"庐江");
    // 177寿春
    addPath( shouchun,"寿春",lujiang,"庐江");

    //178建业-广陵
    addPath( guangling,"广陵",jianye,"建业");
    // 179寿春
    addPath( shouchun,"寿春",jianye,"建业");
    // 180庐江
    addPath( lujiang,"庐江",jianye,"建业");
    // 181吴
    addPath( wu,"吴",jianye,"建业");
    // 182豫章
    addPath( yuzhang,"豫章",jianye,"建业");

    //183吴-建业
    addPath( jianye,"建业",wu,"吴");
    // 184广陵
    addPath( guangling,"广陵",wu,"吴");
    // 185会稽
    addPath( kuaiji,"会稽",wu,"吴");

    //186会稽-吴
    addPath( wu,"吴",kuaiji,"会稽");
    // 187豫章
    addPath( yuzhang,"豫章",kuaiji,"会稽");
    // 188建安
    addPath( jianan,"建安",kuaiji,"会稽");

    //189豫章-江夏
    addPath( jiangxia,"江夏",yuzhang,"豫章");
    // 190建业
    addPath( jianye,"建业",yuzhang,"豫章");
    // 191会稽
    addPath( kuaiji,"会稽",yuzhang,"豫章");
    // 192建安
    addPath( jianan,"建安",yuzhang,"豫章");

    //193建安-豫章
    addPath( yuzhang,"豫章",jianan,"建安");
    // 194南海
    addPath( nanhai,"南海",jianan,"建安");
    // 195会稽
    addPath( kuaiji,"会稽",jianan,"建安");

    //196南海-桂阳
    addPath( guiyang,"桂阳",nanhai,"南海");
    // 197建安
    addPath( jianan,"建安",nanhai,"南海");
    // 198合浦,
    addPath( hepu,"合浦",nanhai,"南海");

    //199合浦-交趾
    addPath( jiaozhi,"交趾",hepu,"合浦");
    // 200牂牁
    addPath( zangke,"牂牁",hepu,"合浦");
    // 201零陵
    addPath( lingling,"零陵",hepu,"合浦");
    // 202南海
    addPath( nanhai,"南海",hepu,"合浦");

    //203交趾-建宁
    addPath( jianning,"建宁",jiaozhi,"交趾");
    // 204合浦
    addPath( hepu,"合浦",jiaozhi,"交趾");

    function addPath(city1, city2, city3, city4){
        if (arguments.length === 2){
            var x1 = list[city1][2][0];
            var y1 = list[city1][2][1];
            var x2 = list[city2][2][0];
            var y2 = list[city2][2][1];
            var latlngs = [
                [x1, y1],
                [x2, y2]
            ];
            L.polyline(latlngs, {color: 'black'}).addTo(map);
        }else{
            var x1 = list[city1][2][0];
            var y1 = list[city1][2][1];
            var x2 = list[city3][2][0];
            var y2 = list[city3][2][1];
            var latlngs = [
                [x1, y1],
                [x2, y2]
            ];
            L.polyline(latlngs, {color: 'black'}).addTo(map);

        }

    }

    if(top != self){
        window.top.location.replace(self.location);
    }
</script>

</body>
</html>